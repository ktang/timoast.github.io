<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Useful python code &middot; DNAwesome
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54133406-1', 'auto');
  ga('send', 'pageview');

</script>


  <body>

    <div class="container content">
      <div class="masthead">
        <h3 class="masthead-title">
          <a href="/" title="Home">DNAwesome</a>
          <small></small>

          
            &nbsp;&nbsp;&nbsp;
            <small><a href="/about">About</a></small>
          
            &nbsp;&nbsp;&nbsp;
            <small><a href="/archive">Archive</a></small>
          
            &nbsp;&nbsp;&nbsp;
            <small><a href="/code">Code</a></small>
          
            &nbsp;&nbsp;&nbsp;
            <small><a href="/atom.xml">Feed</a></small>
          
        </h3>
      </div>

      <div class="post">
  <h1 class="post-title">Useful python code</h1>
  <span class="post-date">25 Aug 2014</span>
  <h3>Take command-line arguments</h3>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">sys</span> <span class="kn">import</span> <span class="n">argv</span>


<span class="k">def</span> <span class="nf">checkArgs</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    arg1 is short arg, eg h</span>
<span class="sd">    arg2 is long arg, eg host</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">arg1</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">arg1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">variable</span>
    <span class="k">elif</span> <span class="n">arg2</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">arg2</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">variable</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">variable</span> <span class="o">=</span> <span class="nb">raw_input</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Enter {arg2}: &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">arg2</span><span class="o">=</span><span class="n">arg2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">variable</span>
</code></pre></div>
<h2>Lists</h2>

<h3>List comprehension</h3>

<p>If ever declaring and empty list then using <code>.append</code>, can be done with list comprehension.</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">list3</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list2</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">list1</span><span class="p">:</span>
        <span class="n">list3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">list3</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">list2</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">list1</span><span class="p">]</span>
</code></pre></div>
<h3>Join items in list</h3>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{l}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">list</span><span class="p">)))</span>
</code></pre></div>
<p>If list items are not strings</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">outfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;{l}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">)))</span>
</code></pre></div>
<p>Or using list comprehension</p>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">stringVersion</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inputList</span><span class="p">]</span>
</code></pre></div>
<h2>Printing</h2>

<h3>Print in colour</h3>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">colour</span><span class="p">:</span>
    <span class="n">PURPLE</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[95m&#39;</span>
    <span class="n">CYAN</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[96m&#39;</span>
    <span class="n">DARKCYAN</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[36m&#39;</span>
    <span class="n">BLUE</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[94m&#39;</span>
    <span class="n">GREEN</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[92m&#39;</span>
    <span class="n">YELLOW</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[93m&#39;</span>
    <span class="n">RED</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[91m&#39;</span>
    <span class="n">BOLD</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[1m&#39;</span>
    <span class="n">UNDERLINE</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[4m&#39;</span>
    <span class="n">END</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\033</span><span class="s">[0m&#39;</span>

<span class="k">print</span> <span class="n">colour</span><span class="o">.</span><span class="n">CYAN</span> <span class="o">+</span> <span class="s">&#39;This is blue&#39;</span> <span class="o">+</span> <span class="n">colour</span><span class="o">.</span><span class="n">END</span>
</code></pre></div>
<h3>Format text wrapping correctly in terminal</h3>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">textwrap</span>
<span class="k">print</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">dedent</span><span class="p">(</span><span class="s">&#39;print message&#39;</span><span class="p">)</span>
</code></pre></div>
<h2>Strings</h2>

<h3>Split strings by multiple delimiters</h3>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">accession_name</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;calls_&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>
<h2>File reading / writing</h2>

<h3>Read lines in tsv/csv file</h3>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;merged_dmrs.bed&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">rsplit</span><span class="p">()</span> <span class="c"># each item in line is now part of a list</span>
</code></pre></div>
<h2>Find if coordinates overlap</h2>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">overlap</span><span class="p">(</span><span class="n">start1</span><span class="p">,</span> <span class="n">stop1</span><span class="p">,</span> <span class="n">start2</span><span class="p">,</span> <span class="n">stop2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;returns True if sets of coordinates overlap. Assumes coordinates are on same chromosome&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">start2</span><span class="p">,</span> <span class="n">stop2</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">start1</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">stop1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
</code></pre></div>
<h2>Functions for mapping NGS reads</h2>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span>


<span class="k">def</span> <span class="nf">peMap</span><span class="p">(</span><span class="n">proc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    paired-end reads</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;_1.fastq&quot;</span><span class="p">):</span>
            <span class="n">sam</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
            <span class="n">sam</span> <span class="o">=</span> <span class="n">sam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">call</span><span class="p">([</span><span class="s">&quot;bowtie2&quot;</span><span class="p">,</span> <span class="s">&quot;-p{x}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">proc</span><span class="p">),</span> <span class="s">&quot;-q&quot;</span><span class="p">,</span> <span class="s">&quot;-x /dd_stage/userdata/lister/data/genomes/bowtie2_indexes/tair9&quot;</span><span class="p">,</span>
                  <span class="s">&quot;-1 {f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">sam</span> <span class="o">+</span> <span class="s">&#39;_1.fastq&#39;</span><span class="p">),</span> <span class="s">&quot;-2 {f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">sam</span> <span class="o">+</span> <span class="s">&#39;_2.fastq&#39;</span><span class="p">),</span> <span class="s">&quot;-S {s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">sam</span> <span class="o">+</span> <span class="s">&#39;.sam&#39;</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>


<span class="k">def</span> <span class="nf">seMap</span><span class="p">(</span><span class="n">proc</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    single-end reads</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;.fastq&quot;</span><span class="p">):</span>
            <span class="n">sam</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">sam</span> <span class="o">=</span> <span class="n">sam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">call</span><span class="p">([</span><span class="s">&quot;bowtie2&quot;</span><span class="p">,</span> <span class="s">&quot;-p{x}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">proc</span><span class="p">),</span> <span class="s">&quot;-q&quot;</span><span class="p">,</span> <span class="s">&quot;-x /dd_stage/userdata/lister/data/genomes/bowtie2_indexes/tair9&quot;</span><span class="p">,</span>
                  <span class="s">&quot;-U {f}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">filename</span><span class="p">),</span> <span class="s">&quot;-S {s}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="o">=</span><span class="n">sam</span> <span class="o">+</span> <span class="s">&#39;.sam&#39;</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
</code></pre></div>
<h2>Split sra files into fastq</h2>
<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span>


<span class="k">def</span> <span class="nf">fastqSplit</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.sra&#39;</span><span class="p">):</span>
            <span class="k">print</span> <span class="s">&#39;processing {n}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">call</span><span class="p">([</span><span class="s">&#39;fastq-dump&#39;</span><span class="p">,</span> <span class="s">&#39;--split-3&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
</code></pre></div>
</div>


      <!-- <div class="footer">
        <p>
          &copy; 2015. All rights reserved.
        </p>
      </div> -->
    </div>

  </body>
</html>
